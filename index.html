<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Crist√£o - Conhecimento B√≠blico</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZ98525YVS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WZ98525YVS');
  </script>

  <!-- Manifesto e Service Worker -->
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log('Service Worker registrado.'));
    }
  </script>

  <!-- √çcones e tema -->
  <meta name="theme-color" content="#FFD700"/>
  <link rel="icon" type="image/png" href="icons/icon-192.png"/>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>

  <style>
    :root { --primary: #FFD700; --dark: #000; --light: #fff; --gray: #f7f7f7; --radius: 12px; }
    body { font-family: 'Poppins', sans-serif; background: var(--light); color: var(--dark); margin:0; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
    header { width:100%; background:var(--primary); padding:18px; font-size:1.6rem; font-weight:600; text-align:center; box-shadow:0 2px 10px rgba(0,0,0,0.08); }
    .quiz-wrapper { width:95%; max-width:520px; background:var(--gray); border-radius:var(--radius); margin-top:30px; padding:35px 25px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center; }
    .question { font-size:1.2rem; font-weight:600; margin-bottom:20px; }
    .options { display:flex; flex-direction:column; gap:12px; }
    .option-btn { background:var(--light); border:2px solid var(--dark); border-radius:var(--radius); padding:12px; font-size:1rem; cursor:pointer; transition:all .25s; }
    .option-btn:hover { background:var(--primary); color:var(--dark); }
    .option-btn.correct { border-color:green; background:#daf5d1; }
    .option-btn.incorrect { border-color:red; background:#ffe0e0; }
    #next-btn { margin-top:25px; background:var(--dark); color:var(--light); border:none; padding:12px 25px; border-radius:var(--radius); font-size:1rem; font-weight:600; cursor:pointer; display:none; }
    #next-btn:hover { background:var(--primary); color:var(--dark); }
    .result { font-size:1.3rem; font-weight:600; margin-top:15px; }
    .share-buttons { margin-top:20px; display:flex; flex-direction:column; gap:12px; }
    .share-buttons a, .share-buttons button { text-decoration:none; color:var(--dark); border:2px solid var(--primary); border-radius:var(--radius); padding:10px 15px; font-weight:600; transition:background .3s; background:var(--light); cursor:pointer; font-size:1rem; font-family:'Poppins',sans-serif; }
    .share-buttons a:hover, .share-buttons button:hover { background:var(--primary); }
    .ad-space { width:100%; max-width:520px; text-align:center; margin:20px 0; background:#fffbea; border-radius:var(--radius); padding:10px; font-size:.9rem; border:1px dashed var(--primary); }
    footer { margin-top:auto; padding:15px; font-size:.85rem; color:#555; }
    .ranking { margin-top:20px; background:var(--light); border:2px solid var(--primary); border-radius:var(--radius); padding:15px; }
    .ranking h3 { margin-top:0; color:var(--dark); }
    .ranking-item { display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; }
    .ranking-item:last-child { border-bottom:none; }
    .loading { color:#666; font-style:italic; }
  </style>
</head>
<body>
  <header>üìñ Quiz Crist√£o</header>

  <div class="quiz-wrapper">
    <div id="quiz-content">
      <div id="question" class="question"></div>
      <div id="answers" class="options"></div>
      <button id="next-btn">Pr√≥xima</button>
    </div>
    <div class="ad-space">
      <!-- An√∫ncio aqui -->
      <p>An√∫ncio</p>
    </div>
  </div>

  <footer>¬© 2025 Quiz Crist√£o | Todos os direitos reservados</footer>

  <script>
    const quiz = [
      {question: "Quem construiu a arca?", options:["Mois√©s","No√©","Abra√£o","Josu√©"], correct:1},
      {question: "Em quantos dias Deus criou o mundo?", options:["5","6","7","8"], correct:1},
      {question: "Quem foi lan√ßado na cova dos le√µes?", options:["Elias","Daniel","Samuel","Davi"], correct:1},
      {question: "Qual ap√≥stolo negou Jesus tr√™s vezes?", options:["Pedro","Jo√£o","Tiago","Tom√©"], correct:0},
      {question: "Em qual cidade Jesus nasceu?", options:["Jerusal√©m","Bel√©m","Nazar√©","Bet√¢nia"], correct:1},
      {question: "Quem foi o primeiro homem criado por Deus?", options:["Abra√£o","Ad√£o","Mois√©s","Isaac"], correct:1},
      {question: "Quantos mandamentos Deus deu a Mois√©s?", options:["7","10","12","5"], correct:1}
    ];
    
    let current=0,score=0;
    const q=document.getElementById("question"), a=document.getElementById("answers"), next=document.getElementById("next-btn");
    
    function load(){
      const item=quiz[current];
      q.textContent=item.question;
      a.innerHTML="";
      next.style.display="none";
      item.options.forEach((t,i)=>{
        const b=document.createElement("button");
        b.classList.add("option-btn");
        b.textContent=t;
        b.onclick=()=>select(i,b);
        a.appendChild(b);
      });
      
      // Evento do Google Analytics: visualiza√ß√£o de pergunta
      if(typeof gtag !== 'undefined') {
        gtag('event', 'pergunta_visualizada', {
          'event_category': 'Quiz',
          'event_label': 'Pergunta ' + (current + 1),
          'value': current + 1
        });
      }
    }
    
    function select(i,b){
      const c=quiz[current].correct;
      Array.from(a.children).forEach(x=>x.disabled=true);
      
      if(i===c){
        score++;
        b.classList.add("correct");
        if(typeof gtag !== 'undefined') {
          gtag('event', 'resposta_correta', {
            'event_category': 'Quiz',
            'event_label': 'Pergunta ' + (current + 1)
          });
        }
      }else{
        b.classList.add("incorrect");
        a.children[c].classList.add("correct");
        if(typeof gtag !== 'undefined') {
          gtag('event', 'resposta_incorreta', {
            'event_category': 'Quiz',
            'event_label': 'Pergunta ' + (current + 1)
          });
        }
      }
      next.style.display="inline-block";
    }
    
    next.onclick=()=>{
      if(++current<quiz.length) {
        load();
      } else {
        showResult();
      }
    };
    
    function showResult(){
      // Mostrar resultado imediatamente
      document.getElementById("quiz-content").innerHTML=`
      <div class="result">
        Voc√™ acertou <strong>${score}</strong> de <strong>${quiz.length}</strong> perguntas! üåü<br><br>
        ${score < 3 ? "Continue aprendendo, Deus aben√ßoa quem busca sabedoria! üìñ" : 
          score < 6 ? "Muito bom! Seu conhecimento est√° crescendo! üôè" :
          "Excelente! Voc√™ demonstra grande conhecimento b√≠blico! ‚ú®"}
      </div>
      <div class="ranking">
        <h3>üèÜ Top 10 Melhores Pontua√ß√µes</h3>
        <p class="loading">Carregando ranking...</p>
      </div>
      <div class="ad-space"><p>An√∫ncio</p></div>
      <div class="share-buttons">
        <a href="https://api.whatsapp.com/send?text=Eu%20acertei%20${score}%20de%20${quiz.length}%20no%20Quiz%20Crist√£o!%20Fa√ßa%20tamb√©m:%20${encodeURIComponent(window.location.href)}" target="_blank">üì± Compartilhar no WhatsApp</a>
        <a href="https://facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank">üì£ Compartilhar no Facebook</a>
        <button onclick="window.location.reload()">üîÑ Refazer Quiz</button>
      </div>`;
      
      // Evento do Google Analytics: quiz finalizado
      if(typeof gtag !== 'undefined') {
        gtag('event', 'quiz_finalizado', {
          'event_category': 'Quiz',
          'event_label': 'Pontua√ß√£o',
          'value': score
        });
      }
      
      // Salvar pontua√ß√£o e carregar ranking (ass√≠ncrono, n√£o bloqueia a UI)
      saveAndLoadRanking();
    }
    
    async function saveAndLoadRanking() {
      try {
        // Salvar pontua√ß√£o no Firebase
        if(window.saveScore) {
          await window.saveScore(score, quiz.length);
        }
        
        // Carregar ranking
        if(window.loadRanking) {
          const ranking = await window.loadRanking();
          const rankingDiv = document.querySelector('.ranking');
          
          if(ranking.length > 0) {
            rankingDiv.innerHTML = `
              <h3>üèÜ Top 10 Melhores Pontua√ß√µes</h3>
              ${ranking.map((item, index) => `
                <div class="ranking-item">
                  <span>${index + 1}¬∫ lugar</span>
                  <span><strong>${item.pontuacao}</strong> de ${item.total}</span>
                </div>
              `).join('')}
            `;
          } else {
            rankingDiv.innerHTML = `
              <h3>üèÜ Top 10 Melhores Pontua√ß√µes</h3>
              <p>Seja o primeiro a pontuar!</p>
            `;
          }
        }
      } catch(error) {
        console.error('Erro ao processar ranking:', error);
        const rankingDiv = document.querySelector('.ranking');
        if(rankingDiv) {
          rankingDiv.innerHTML = `
            <h3>üèÜ Ranking</h3>
            <p>N√£o foi poss√≠vel carregar o ranking no momento.</p>
          `;
        }
      }
    }
    
    load();
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
    import { getDatabase, ref, push, query, orderByChild, limitToLast, get } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBj2RLZGicJnVfCV6BJafB91bvH65rC8zM",
      authDomain: "quizgracadiaria.firebaseapp.com",
      projectId: "quizgracadiaria",
      storageBucket: "quizgracadiaria.firebasestorage.app",
      messagingSenderId: "921062227849",
      appId: "1:921062227849:web:71ecd5eaf45c0e44aa6b58",
      measurementId: "G-4X34EZH430"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);

    // Tornar fun√ß√µes dispon√≠veis globalmente
    window.firebaseAnalytics = analytics;
    window.firebaseDatabase = database;
    window.logEvent = logEvent;
    
    window.saveScore = async (score, total) => {
      try {
        const scoresRef = ref(database, 'scores');
        await push(scoresRef, {
          pontuacao: score,
          total: total,
          data: new Date().toISOString(),
          timestamp: Date.now()
        });
        console.log('Pontua√ß√£o salva com sucesso!');
        
        // Log evento no Firebase Analytics
        logEvent(analytics, 'quiz_completed', {
          score: score,
          total: total,
          percentage: Math.round((score/total)*100)
        });
      } catch (error) {
        console.error('Erro ao salvar pontua√ß√£o:', error);
      }
    };

    window.loadRanking = async () => {
      try {
        const scoresRef = ref(database, 'scores');
        const topScoresQuery = query(scoresRef, orderByChild('pontuacao'), limitToLast(10));
        const snapshot = await get(topScoresQuery);
        
        if (snapshot.exists()) {
          const scores = [];
          snapshot.forEach((childSnapshot) => {
            scores.push(childSnapshot.val());
          });
          
          // Ordenar do maior para o menor
          scores.sort((a, b) => b.pontuacao - a.pontuacao);
          
          return scores;
        }
        return [];
      } catch (error) {
        console.error('Erro ao carregar ranking:', error);
        return [];
      }
    };
  </script>

  <!-- Google AdSense (substitua pelo seu c√≥digo quando aprovado) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=SEU_CODIGO_ADSENSE" crossorigin="anonymous"></script>
</body>
</html>
